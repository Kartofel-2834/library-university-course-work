import{d as J,c as z,w as X,o as D,a as U,b as p,e as l,n as s,f as V,g as d,u as i,h as b,E as F,_ as K,i as Z,r as B,t as q,j as G,k as x,F as ee,l as se}from"./index-9cr8EWnL.js";import{E as W,u as te}from"./books-d0ko1H0c.js";import{u as le,E as ae}from"./requests-2acdPTx-.js";import{P as oe,E,a as j,h as O}from"./PotIcon-I0iWhTWp.js";import{P as ne,B as ie,C as w}from"./BaseHeader-6PBSh6ly.js";import{B as ue,a as re}from"./BookDetail-CC2pHj4H.js";import{u as de,P as L,a as ce}from"./PotInputBase-C7Rk3pmf.js";const me=["src"],ve=["value"],pe=["value"],ge=J({__name:"BookAddForm",props:{isOpen:{type:Boolean,default:!1}},emits:["close","submit"],setup(N,{emit:A}){const g=N,R=A,c=ce(),r=de({name:[c.REQUIRED()],author:[c.REQUIRED()],publicationDate:[c.REQUIRED(),c.DATE_VALID()],receiptDate:[c.REQUIRED(),c.DATE_VALID()],description:[c.REQUIRED()],details:[c.REQUIRED()]}),m=z(()=>r.values.value);X(()=>g.isOpen,()=>{g.isOpen&&r.change({})});function k(){R("close")}function I(){r.validate()&&R("submit",S(r.values.value))}function v(e,a){const n=a.target;r.changeField(e,n.value)}function f(e){const a=e.target,n=a==null?void 0:a.files;if(!n||!n.length)return;const[C]=n;if(!/jpg|jpeg|png/.test(C.type))return;const y=new FileReader;y.onload=()=>{typeof y.result=="string"&&r.changeField("imageUrl",y.result)},y.readAsDataURL(C)}function S(e){return{id:Math.floor(Math.random()*1e6),name:e.name??"",author:e.author??"",status:W.AVAILABLE,description:e.description??"",details:e.details??"",imageUrl:e.imageUrl||null,receiptDate:O(e.receiptDate),publicationDate:O(e.publicationDate),issueDate:null,reader:null}}return(e,a)=>(D(),U(ne,{class:s([e.$style.BookAddForm,"book-add-form"]),"is-open":e.isOpen,onClose:k},{default:p(()=>[l("div",{class:s([e.$style.content,"book-add-form__content"])},[l("div",{class:s(e.$style.title)},"Добавление книги",2),l("div",{class:s(e.$style.fieldsList)},[l("label",{class:s(e.$style.image)},[l("div",{class:s(e.$style.imageInner)},[m.value.imageUrl?(D(),V("img",{key:1,class:s(e.$style.imagePreview),src:m.value.imageUrl},null,10,me)):(D(),U(oe,{key:0,icon:"plus",size:"72"}))],2),l("input",{class:s(e.$style.imageInput),type:"file",accept:".jpeg,.jpg,.png",onChange:f},null,34)],2),l("div",{class:s(e.$style.field)},[l("div",{class:s(e.$style.label)},"Название",2),d(L,{value:m.value.name,size:i(E).SMALL,onInput:a[0]||(a[0]=n=>i(r).changeField("name",String(n)))},null,8,["value","size"])],2),l("div",{class:s(e.$style.field)},[l("div",{class:s(e.$style.label)},"Автор",2),d(L,{value:m.value.author,size:i(E).SMALL,onInput:a[1]||(a[1]=n=>i(r).changeField("author",String(n)))},null,8,["value","size"])],2),l("div",{class:s(e.$style.field)},[l("div",{class:s(e.$style.label)},"Дата публикации",2),d(L,{value:m.value.publicationDate,size:i(E).SMALL,type:"date",onInput:a[2]||(a[2]=n=>i(r).changeField("publicationDate",String(n)))},null,8,["value","size"])],2),l("div",{class:s(e.$style.field)},[l("div",{class:s(e.$style.label)},"Дата поступления",2),d(L,{value:m.value.receiptDate,size:i(E).SMALL,type:"date",onInput:a[3]||(a[3]=n=>i(r).changeField("receiptDate",String(n)))},null,8,["value","size"])],2),l("div",{class:s(e.$style.field)},[l("div",{class:s(e.$style.label)},"Описание",2),l("textarea",{value:m.value.description,class:s(e.$style.textarea),onInput:a[4]||(a[4]=n=>v("description",n))},null,42,ve)],2),l("div",{class:s(e.$style.field)},[l("div",{class:s(e.$style.label)},"Доп. информация",2),l("textarea",{value:m.value.details,class:s(e.$style.textarea),onInput:a[5]||(a[5]=n=>v("details",n))},null,42,pe)],2)],2),l("div",{class:s(e.$style.actions)},[d(j,{class:s(e.$style.submitButton),disabled:!i(r).isValid.value,onClick:I},{default:p(()=>a[6]||(a[6]=[b(" Сохранить ")])),_:1},8,["class","disabled"]),d(j,{class:s(e.$style.submitButton),color:i(F).SECONDARY,onClick:k},{default:p(()=>a[7]||(a[7]=[b(" Закрыть ")])),_:1},8,["class","color"])],2)],2)]),_:1},8,["class","is-open"]))}}),fe="_title_5g3a7_348",ye="_content_5g3a7_357",$e="_fieldsList_5g3a7_367",ke="_image_5g3a7_385",Be="_imageInner_5g3a7_389",be="_imagePreview_5g3a7_401",De="_imageInput_5g3a7_409",Ae="_field_5g3a7_367",Ee="_label_5g3a7_419",Ie="_textarea_5g3a7_427",Le="_actions_5g3a7_454",Re={title:fe,content:ye,fieldsList:$e,image:ke,imageInner:Be,imagePreview:be,imageInput:De,field:Ae,label:Ee,textarea:Ie,actions:Le},Se={$style:Re},Ce=K(ge,[["__cssModules",Se]]),_e=J({__name:"HomePage",setup(N){const A=te(),g=Z(),R=le(),c=B(""),r=B(""),m=B(!1),k=B(!1),I=B(null),v=B(null),f=B(null),S=z(()=>g.isAdmin?"Книги":"Электронный каталог"),e=z(()=>{const o=c.value.toLowerCase();return(g.isAdmin?A.books.filter(u=>u.status!==W.OCCUPIED):A.availableBooks).filter(u=>{var $,_,T,Y,M,H,Q,P,h;return((T=(_=($=u.name)==null?void 0:$.toLowerCase())==null?void 0:_.includes)==null?void 0:T.call(_,o))||((H=(M=(Y=u.author)==null?void 0:Y.toLowerCase())==null?void 0:M.includes)==null?void 0:H.call(M,o))||((h=(P=(Q=u.publicationDate)==null?void 0:Q.format("YYYY"))==null?void 0:P.includes)==null?void 0:h.call(P,o))})});function a(){if(!(!v.value||!g.isReader))try{R.addRequest({id:Math.floor(Math.random()*1e6),book:v.value,reader:g.target,status:ae.PENDING,createdDate:O(),comment:null})}catch(o){y(o.message)}finally{v.value=null}}function n(){if(f.value)try{A.deleteBook(f.value)}catch(o){y(o.message)}finally{f.value=null}}function C(o){try{A.addBook(o)}catch(t){y(t.message)}finally{k.value=!1}}function y(o){r.value=o,m.value=!0}return(o,t)=>(D(),V("div",{class:s(o.$style.HomePage)},[d(ie,null,{title:p(()=>[b(q(S.value),1)]),default:p(()=>[l("div",{class:s(o.$style.headerActions)},[d(L,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=u=>c.value=u),class:s(o.$style.search),placeholder:"Поиск"},null,8,["modelValue","class"]),i(g).isAdmin?(D(),U(j,{key:0,class:s(o.$style.addBookButton),color:i(F).PRIMARY_LIGHT,devices:[i(G).TABLET,i(G).MOBILE],size:[i(E).MEDIUM,i(E).SMALL],onClick:t[1]||(t[1]=u=>k.value=!0)},{default:p(()=>t[10]||(t[10]=[b(" Добавить книгу ")])),_:1},8,["class","color","devices","size"])):x("",!0)],2)]),_:1}),l("main",{class:s(o.$style.main)},[l("section",{class:s([o.$style.HomePage,"container"])},[l("h1",{class:s(o.$style.title)},q(S.value),3),l("div",{class:s(o.$style.wrapper)},[l("div",{class:s(o.$style.books)},[(D(!0),V(ee,null,se(e.value,u=>(D(),U(re,{key:`Book_${u.id}`,book:u,onDetails:t[2]||(t[2]=$=>I.value=$),onBook:t[3]||(t[3]=$=>v.value=$),onDelete:t[4]||(t[4]=$=>f.value=$)},null,8,["book"]))),128))],2)],2)],2)],2),d(ue,{book:I.value,onClose:t[5]||(t[5]=u=>I.value=null)},null,8,["book"]),d(Ce,{"is-open":k.value,onClose:t[6]||(t[6]=u=>k.value=!1),onSubmit:C},null,8,["is-open"]),d(w,{"is-open":v.value!==null,onAccept:a,onReject:t[7]||(t[7]=u=>v.value=null)},{default:p(()=>t[11]||(t[11]=[b(" Вы уверены, что хотите подать заявку для получения книги? ")])),_:1},8,["is-open"]),d(w,{"is-open":f.value!==null,"accept-color":i(F).DANGER,"reject-color":i(F).SECONDARY,onAccept:n,onReject:t[8]||(t[8]=u=>f.value=null)},{default:p(()=>t[12]||(t[12]=[b(" Вы уверены, что хотите удалить книгу из базы? ")])),_:1},8,["is-open","accept-color","reject-color"]),d(w,{"is-open":m.value,"reject-label":null,"accept-label":"Ок",onAccept:t[9]||(t[9]=u=>m.value=!1)},{default:p(()=>[b(q(r.value),1)]),_:1},8,["is-open"])],2))}}),Me="_headerActions_qylt0_348",Pe="_addBookButton_qylt0_354",Fe="_main_qylt0_358",Ue="_title_qylt0_362",qe="_books_qylt0_387",we="_actions_qylt0_404",ze="_search_qylt0_411",Ve="_loadButton_qylt0_416",je={headerActions:Me,addBookButton:Pe,main:Fe,title:Ue,books:qe,actions:we,search:ze,loadButton:Ve},Oe={$style:je},Je=K(_e,[["__cssModules",Oe]]);export{Je as default};
