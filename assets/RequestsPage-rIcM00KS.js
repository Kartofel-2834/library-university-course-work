import{d as L,i as T,c as G,o as l,f as v,e as r,n,k as R,t as b,u as t,h as c,a as j,b as g,E as q,_ as I,r as A,g as _,F as M,l as z}from"./index-CrAxCzrP.js";import{u as V}from"./requests-D6g8YWbJ.js";import{B as F,C}from"./BaseHeader-B3Rl0hgh.js";import{E,a as S}from"./PotIcon-CX_t0_LZ.js";import"./books-DZR1Uoqf.js";const O=["src"],U=L({__name:"RequestCard",props:{request:{}},emits:["accept","reject","delete"],setup(D,{emit:y}){const a=D,$=y,d=T(),m=G(()=>[a.request.reader.surname,a.request.reader.name,a.request.reader.fathername].join(" "));function f(){$("accept",a.request)}function p(){$("reject",a.request)}function N(){$("delete",a.request)}return(o,u)=>(l(),v("div",{class:n([o.$style.RequestCard,"request-card"])},[r("div",{class:n(o.$style.content)},[o.request.book.imageUrl?(l(),v("div",{key:0,class:n(o.$style.image)},[r("img",{class:n(o.$style.imageTarget),src:o.request.book.imageUrl},null,10,O)],2)):R("",!0),r("div",{class:n(o.$style.info)},[r("div",{class:n(o.$style.bookName)},b(o.request.book.name),3),r("div",{class:n(o.$style.bookAuthor)},b(o.request.book.author),3),t(d).isAdmin?(l(),v("div",{key:0,class:n(o.$style.creator)},[u[0]||(u[0]=r("span",null,"Запросил:",-1)),c(" "+b(m.value)+", "+b(o.request.reader.studentId),1)],2)):R("",!0)],2)],2),r("div",{class:n(o.$style.actions)},[t(d).isAdmin?(l(),j(S,{key:0,size:t(E).SMALL,onClick:f},{default:g(()=>u[1]||(u[1]=[c(" Выдать ")])),_:1},8,["size"])):R("",!0),t(d).isAdmin?(l(),j(S,{key:1,size:t(E).SMALL,color:t(q).DANGER,onClick:p},{default:g(()=>u[2]||(u[2]=[c(" Отклонить ")])),_:1},8,["size","color"])):R("",!0),t(d).isReader?(l(),j(S,{key:2,size:t(E).SMALL,color:t(q).DANGER,onClick:N},{default:g(()=>u[3]||(u[3]=[c(" Отозвать ")])),_:1},8,["size","color"])):R("",!0)],2)],2))}}),Y="_RequestCard_1qwgf_348",H="_actions_1qwgf_363",J="_content_1qwgf_377",K="_image_1qwgf_388",Q="_imageTarget_1qwgf_405",W="_info_1qwgf_413",X="_bookAuthor_1qwgf_424",Z="_bookName_1qwgf_437",h="_creator_1qwgf_449",x="_studentId_1qwgf_465",ee="_fullname_1qwgf_487",te={RequestCard:Y,actions:H,content:J,image:K,imageTarget:Q,info:W,bookAuthor:X,bookName:Z,creator:h,studentId:x,fullname:ee},se={$style:te},B=I(U,[["__cssModules",se]]),oe={class:"container"},ne={class:"container"},le=L({__name:"RequestsPage",setup(D){const y=T(),a=V(),$=A(""),d=A(!1),m=A(null),f=A(null),p=A(null),N=G(()=>y.isAdmin?[]:a.pendingRequests.filter(s=>{var e;return s.reader.id===((e=y.target)==null?void 0:e.id)}));function o(){if(m.value)try{a.deleteRequest(m.value)}catch(s){w(s.message)}finally{m.value=null}}function u(){if(p.value)try{a.acceptRequest(p.value)}catch(s){w(s.message)}finally{p.value=null}}function P(){if(f.value)try{a.rejectRequest(f.value)}catch(s){w(s.message)}finally{f.value=null}}function w(s){$.value=s,d.value=!0}return(s,e)=>(l(),v("div",{class:n(s.$style.RequestsPage)},[_(F,null,{title:g(()=>e[7]||(e[7]=[c(" Запросы книг на выдачу ")])),_:1}),t(y).isAdmin?(l(),v("main",{key:0,class:n(s.$style.main)},[r("div",oe,[r("h1",{class:n(s.$style.title)},"Запросы книг на выдачу",2),r("div",{class:n(s.$style.list)},[(l(!0),v(M,null,z(t(a).pendingRequests,i=>(l(),j(B,{key:i.id,request:i,onAccept:e[0]||(e[0]=k=>p.value=k),onReject:e[1]||(e[1]=k=>f.value=k)},null,8,["request"]))),128))],2)])],2)):R("",!0),t(y).isReader?(l(),v("main",{key:1,class:n(s.$style.main)},[r("div",ne,[r("h1",{class:n(s.$style.title)},"Мои запросы",2),r("div",{class:n(s.$style.list)},[(l(!0),v(M,null,z(N.value,i=>(l(),j(B,{key:i.id,request:i,onDelete:e[2]||(e[2]=k=>m.value=k)},null,8,["request"]))),128))],2)])],2)):R("",!0),_(C,{"is-open":m.value!==null,"accept-color":t(q).DANGER,"reject-color":t(q).SECONDARY,onAccept:o,onReject:e[3]||(e[3]=i=>m.value=null)},{default:g(()=>e[8]||(e[8]=[c(" Вы уверены, что хотите отозвать свою заявку? ")])),_:1},8,["is-open","accept-color","reject-color"]),_(C,{"is-open":p.value!==null,"accept-color":t(q).PRIMARY,"reject-color":t(q).DANGER,onAccept:u,onReject:e[4]||(e[4]=i=>p.value=null)},{default:g(()=>e[9]||(e[9]=[c(" Вы уверены, что хотите одобрить выдачу книги? ")])),_:1},8,["is-open","accept-color","reject-color"]),_(C,{"is-open":f.value!==null,"accept-color":t(q).DANGER,"reject-color":t(q).SECONDARY,onAccept:P,onReject:e[5]||(e[5]=i=>f.value=null)},{default:g(()=>e[10]||(e[10]=[c(" Вы уверены, что хотите отклонить запрос? ")])),_:1},8,["is-open","accept-color","reject-color"]),_(C,{"is-open":d.value,"reject-label":null,"accept-label":"Ок",onAccept:e[6]||(e[6]=i=>d.value=!1)},{default:g(()=>[c(b($.value),1)]),_:1},8,["is-open"])],2))}}),re="_main_1b6hi_348",ae="_title_1b6hi_352",ue="_list_1b6hi_377",ie={main:re,title:ae,list:ue},ce={$style:ie},ve=I(le,[["__cssModules",ce]]);export{ve as default};
